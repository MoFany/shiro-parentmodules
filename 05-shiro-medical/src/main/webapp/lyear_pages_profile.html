<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>个人信息 - 光年(Light Year Admin)后台管理系统模板</title>
    <link rel="icon" href="favicon.ico" type="image/ico">
    <meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
    <meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
    <meta name="author" content="yinqi">
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="static/css/style.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/js/bootstrap-fileinput/css/bootstrap-icons.min.css" crossorigin="anonymous">
    <link href="static/js/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" crossorigin="anonymous">
    <link href="static/js/bootstrap-fileinput/themes/explorer-fa5/theme.css" media="all" rel="stylesheet"
          type="text/css"/>
    <style>
        .kv-avatar .krajee-default.file-preview-frame, .kv-avatar .krajee-default.file-preview-frame:hover {
            margin: 0;
            padding: 0;
            border: none;
            box-shadow: none;
            text-align: center;
        }

        .kv-avatar {
            display: inline-block;
        }

        .kv-avatar .file-input {
            display: table-cell;
            width: 213px;
        }

        .kv-reqd {
            color: red;
            font-family: monospace;
            font-weight: normal;
        }
    </style>
</head>

<body>
<!--vue实例挂载的模型对象-->
<div id="profile" class="container-fluid p-t-15">

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">

                    <div class="edit-avatar">
<!--                      修改头像-->
                        <img id="userAvatar" :src="avatar" alt="..." class="img-avatar">
                        <div class="avatar-divider"></div>
                        <div class="edit-avatar-content">
                            <button class="btn btn-default" data-toggle="modal" data-target="#exampleModal">修改头像
                            </button>
                        </div>
                    </div>
                    <hr>
                    <form>
                        <div class="form-group">
                            <label for="username">用户名</label>
                            <input type="text" class="form-control" name="username" id="username" v-model="user_name"/>
                        </div>
                        <div class="form-group">
                            <label for="nickname">昵称</label>
                            <input type="text" class="form-control" name="nickname" id="nickname" placeholder="输入您的昵称"
                                   v-model="nick_name">
                        </div>
                        <div class="form-group">
                            <label for="email">邮箱</label>
                            <input type="email" class="form-control" name="email" id="email"
                                   aria-describedby="emailHelp" placeholder="请输入正确的邮箱地址" v-model="email">
                            <small id="emailHelp" class="form-text text-muted">请保证您填写的邮箱地址是正确的。</small>
                        </div>
                        <div class="form-group">
                            <label for="email">手机号码</label>
                            <input type="email" class="form-control" name="email" id="phonenumber"
                                   aria-describedby="emailHelp" placeholder="请输入正确的手机号码" v-model="phonenumber">
                        </div>
                        <div class="form-group">
                            <label for="remark">简介</label>
                            <textarea class="form-control" name="remark" id="remark" rows="3"
                                      v-model="remark"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<!--头像上传的模态框-->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">上传头像</h4>
            </div>
            <div class="modal-body">
                <div id="kv-avatar-errors-2" class="center-block" style="width:800px;display:none"></div>
                <form class="form form-vertical"
                      enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-sm-4 text-center">
                            <div class="kv-avatar">
                                <div class="file-loading">
                                    <input id="avatar-2" name="avatar-2" type="file" required>
                                </div>
                            </div>
                            <div class="kv-avatar-hint">
                                <small>上传的文件小于1500 KB</small>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="avatarUpload">上传头像</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
<!--<script type="text/javascript" src="static/js/jquery.min.js"></script>-->
<script type="text/javascript" src="static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="static/js/main.min.js"></script>
<!---->
<script type="text/javascript" src="static/js/vue.global.js"></script>
<script type="text/javascript" src="static/js/axios.min.js"></script>
<script type="text/javascript" src="static/js/api.js"></script>
<!---->
<script src="static/js/bootstrap-fileinput/js/plugins/buffer.min.js" type="text/javascript"></script>
<script src="static/js/bootstrap-fileinput/js/plugins/filetype.min.js" type="text/javascript"></script>
<script src="static/js/bootstrap-fileinput/js/plugins/piexif.js" type="text/javascript"></script>
<script src="static/js/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
<script src="static/js/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>

<script>
    var btnCust = '<button type="button" class="btn btn-secondary" title="Add picture tags" ' +
        'onclick="alert(\'Call your custom code here.\')">' +
        '<i class="bi-tag"></i>' +
        '</button>'

    /**
     * jquery文件上传
     * */
    $("#avatar-2").fileinput({
        overwriteInitial: true,
        maxFileSize: 1500,
        showClose: false,
        showCaption: false,
        showBrowse: false,
        browseOnZoneClick: true,
        removeLabel: '',
        removeIcon: '<i class="bi-x-lg"></i>',
        removeTitle: 'Cancel or reset changes',
        elErrorContainer: '#kv-avatar-errors-2',
        msgErrorClass: 'alert alert-block alert-danger',
        defaultPreviewContent: '<img src="static/images/default-avatar-male.png" alt="Your Avatar"><h6 class="text-muted">点击添加图片</h6>',
        layoutTemplates: {main2: '{preview} ' + btnCust + ' {remove} {browse}'},
        allowedFileExtensions: ["jpg", "png", "gif"]
    });


    /**
     * jquery自定义事件
     * */
    $('#avatarUpload').click(() => {
        // 上传头像
        console.log('----------上传头像----------------')
        // 实现多文件上传
        let file = $('#avatar-2')[0].files[0]
        let formData = new FormData()
        formData.append('file', file)
        console.log(formData)
        avatarAjaxUpload(formData).then(res => {
            console.log(res)
            $('#userAvatar').attr('src', res.data)
            $('#exampleModal').modal('hide')
        })
    })
</script>

<script>

    /**
     * 头像上传
     * */
    var btnCust = '<button type="button" class="btn btn-secondary" title="Add picture tags" ' +
        'onclick="alert(\'Call your custom code here.\')">' +
        '<i class="bi-tag"></i>' +
        '</button>'

    $("#avatar-2").fileinput({
        overwriteInitial: true,
        maxFileSize: 1500,
        showClose: false,
        showCaption: false,
        showBrowse: false,
        browseOnZoneClick: true,
        removeLabel: '',
        removeIcon: '<i class="bi-x-lg"></i>',
        removeTitle: 'Cancel or reset changes',
        elErrorContainer: '#kv-avatar-errors-2',
        msgErrorClass: 'alert alert-block alert-danger',
        defaultPreviewContent: '<img src="static/images/default-avatar-male.png" alt="Your Avatar"><h6 class="text-muted">点击添加图片</h6>',
        layoutTemplates: {main2: '{preview} ' + btnCust + ' {remove} {browse}'},
        allowedFileExtensions: ["jpg", "png", "gif"]
    });

    $('#avatarUpload').click(() => {
        // 上传头像
        console.log('----------上传头像----------------')
        // 实现多文件上传
        let file = $('#avatar-2')[0].files[0]
        let formData = new FormData()
        formData.append('file', file)
        //获取键为username的session属性值
        formData.append('username', sessionStorage.getItem("username"))
        console.log(formData)
        avatarAjaxUpload(formData).then(res => {
            console.log(res)
            $('#userAvatar').attr('src', res.data)
            // 关闭模态框
            $('#exampleModal').modal('hide')
        })
    })
</script>

<script>
    /**
     * 信息展示
     * */
    const App = {
        /**
         * 上传头像
         * */
        setup() {
            // 查询当前登录的用户信息
            let {ref, reactive, onMounted, toRefs} = Vue
            let file = ref()
            let currentUser = reactive({
                avatar: '',
                user_name: '',
                nick_name: '',
                email: '',
                phonenumber: '',
                remark: ''
            });


            let {avatar, user_name, nick_name, email, phonenumber, remark} = toRefs(currentUser);
            /**
             * 根据用户名去查询用户信息
             * */
            onMounted(async () => {
                let username=sessionStorage.getItem("username");
                //通过session获取当前用户名作为参数
                await findByUserName(username)
                    .then((res) => {
                        console.log(res.data)
                        avatar.value = res.data.avatar
                        user_name.value = res.data.user_name
                        nick_name.value = res.data.nick_name
                        email.value = res.data.email
                        phonenumber.value = res.data.phonenumber
                        remark.value = res.data.remark
                    });
            })

            //返回模型对象中要用的
            return {
                currentUser,
                avatar,
                user_name,
                nick_name,
                email,
                phonenumber,
                remark,
                file,
            }
        }
    }
    Vue.createApp(App).mount('#profile')
</script>
</body>
</html>